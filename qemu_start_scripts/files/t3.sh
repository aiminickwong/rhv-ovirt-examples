#!/bin/bash

cp /usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd /tmp/my_vars.fd
/usr/libexec/qemu-kvm \
-enable-kvm \
-name guest=ubtest,debug-threads=on \
-machine pc-i440fx-rhel7.3.0,accel=kvm,usb=off \
-m size=1048576k,slots=16,maxmem=4194304k \
-realtime mlock=off -smp 1,maxcpus=16,sockets=16,cores=1,threads=1 \
-numa node,nodeid=0,cpus=0,mem=1024 -uuid af12e07d-920b-4d4e-89c2-5744e8408d2d \
-smbios type=1,manufacturer=oVirt,product="oVirt Node",version=7-3.1611.el7.centos,serial=F082B2BA-D2F8-E311-AA82-4439C44F6F72,uuid=af12e07d-920b-4d4e-89c2-5744e8408d2d \
-nographic \
-no-user-config \
-nodefaults \
-rtc base=2017-03-02T05:26:13,driftfix=slew \
-global kvm-pit.lost_tick_policy=discard \
-no-hpet \
-no-shutdown \
-cpu host,kvm=off,hv_relaxed,hv_spinlocks=0x1fff,hv_vapic,hv_time,hv_vendor_id=Nvidia43FIX \
-vga none \
-boot strict=on \
-usb -usbdevice host:06cb:0009 \
-usb -usbdevice host:04b3:3018 \
-usb -usbdevice host:04d9:a070 \
-usb -usbdevice host:04b3:3016 \
-device virtio-scsi-pci,id=scsi0,bus=pci.0,addr=0x3 \
-device virtio-serial-pci,id=virtio-serial0,max_ports=16,bus=pci.0,addr=0x4 \
-device vfio-pci,host=01:00.1,id=hostdev0,bus=pci.0,addr=0x5 \
-device vfio-pci,host=01:00.0,id=hostdev1,bus=pci.0,addr=0x6 \
-drive if=pflash,format=raw,readonly,file=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd \
-device virtio-scsi-pci,id=scsi \
-drive file=/rhev/data-center/mnt/192.168.1.30:_export_iso/8a2492ae-d407-46e0-8342-4ce973450614/images/11111111-1111-1111-1111-111111111111/ubuntu-16.10-server-amd64.iso,format=raw,if=none,id=drive-ide0-1-0,readonly=on \
-device ide-cd,bus=ide.1,unit=0,drive=drive-ide0-1-0,id=ide0-1-0,bootindex=1 \
-drive file=/rhev/data-center/605a4733-3d8e-4a4c-a09c-18566787c566/32fcc0bb-30bb-48dc-9e0f-80470372cbb9/images/b18b966d-e1b8-41d7-8904-eb7fda96b8ce/b25e3acb-d9fc-403d-b77a-7236a73c4eb7,format=raw,if=none,id=drive-scsi0-0-0-0,serial=b18b966d-e1b8-41d7-8904-eb7fda96b8ce,cache=none,werror=stop,rerror=stop,aio=threads \
-device scsi-hd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0,bootindex=2 \
-chardev socket,id=charchannel0,path=/var/lib/libvirt/qemu/channels/af12e07d-920b-4d4e-89c2-5744e8408d2d.com.redhat.rhevm.vdsm,server,nowait \
-device virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=com.redhat.rhevm.vdsm \
-chardev socket,id=charchannel1,path=/var/lib/libvirt/qemu/channels/af12e07d-920b-4d4e-89c2-5744e8408d2d.org.qemu.guest_agent.0,server,nowait \
-device virtserialport,bus=virtio-serial0.0,nr=2,chardev=charchannel1,id=channel1,name=org.qemu.guest_agent.0 \
-device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 \
-object rng-random,id=objrng0,filename=/dev/urandom \
-device virtio-rng-pci,rng=objrng0,id=rng0,bus=pci.0,addr=0x8 \
-msg timestamp=on
